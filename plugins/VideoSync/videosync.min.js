Videosync={yt_id:null,started:null,tag:null,streamTag:null,player:null,height:390,width:640,active:false,cookie:"VideoSyncState",tolerance:2,videoFrame:"videosync_box",asideFrame:"videosync_aside",trigger:"videosync_btn",noticeBox:SN.C.S.NoticeDataText,syncChannel:null,oldFeedHandler:null,oldAPIHandler:null,init:function(b){var a=Videosync;if(!$("#"+a.trigger).length){return}if(b){a.yt_id=b.yt_id;a.started=b.started;a.syncChannel=b.channel;a.tag=b.tag;a.streamTag=b.tag.split(" ")[0]}if(typeof YT=="undefined"){a.loadApi();return}a.active=a.getCookie();$(function(){$("#"+a.trigger).click(a.clickButton);$(".form_switchvideo .submit").live("click",function(){var d=$('<input name="'+$(this).attr("name")+'" type="hidden" value="'+$(this).attr("value")+'" />');var c=$(this).closest("form");c.append(d);SN.U.FormXHR(c);return false});a.toggleFrame()})},initPlayer:function(){var a=Videosync;a.player=new YT.Player(a.videoFrame,{height:a.height,width:a.width,videoId:a.yt_id,events:{onReady:function(){a.updatePlayer(a.yt_id,new Date().getTime()/1000-a.started,a.started,a.tag)},},})},getCookie:function(){if($.cookie(Videosync.cookie)){return true}else{return false}},setupReset:function(){var b=Videosync;var c=$("#"+b.noticeBox);var a=c.val();c.val("");if(b.active){b.addTag()}c.html(function(){return this.value});c.val(a)},addTag:function(){var b=Videosync;if(b.tag){var a="#"+b.tag+" ";var c=$("#"+b.noticeBox);c.val(a+c.val().replace(a,""))}},removeTag:function(){var b=Videosync;if(b.tag){var a="#"+b.tag+" ";var c=$("#"+b.noticeBox);c.val(c.val().replace(a,""))}},toggleCookie:function(){var a=Videosync;if($.cookie(a.cookie)){a.active=false;$.cookie(a.cookie,null,{expires:1,path:"/"})}else{a.active=true;$.cookie(a.cookie,"true",{expires:1,path:"/"})}},updatePlayer:function(d,e,c,a){var b=Videosync;if(typeof b.player.getCurrentTime!="undefined"){if(d!=b.yt_id){b.yt_id=d;b.started=c;b.removeTag();b.tag=a;b.setupReset();b.addTag();b.player.loadVideoById(b.yt_id,e,"large")}else{if(Math.abs(b.player.getCurrentTime()-e)>b.tolerance){b.player.seekTo(e)}}}},clickButton:function(){var a=Videosync;a.toggleCookie();a.toggleFrame()},loadApi:function(){$.getScript("//www.youtube.com/iframe_api")},toggleFrame:function(){var a=Videosync;if(a.active){$("#"+a.trigger).val("\u25B2 Hide #"+a.streamTag+" \u25B2");a.initPlayer();a.setupReset();a.addTag();a.setupFeed();$("#"+a.videoFrame).show();$("#"+a.asideFrame).show()}else{$("#"+a.trigger).val("\u25BC Watch videos together on the #"+a.streamTag+"! \u25BC");$("#"+a.videoFrame).replaceWith('<div id="'+a.videoFrame+'"></div>');a.player=null;a.setupReset();a.removeTag();a.removeFeed();$("#"+a.videoFrame).hide();$("#"+a.asideFrame).hide()}},setupFeed:function(){var a=Videosync;a.oldFeedHandler=Meteor.callbacks.process;Meteor.callbacks.process=function(b){a.handleFeed(b)};Meteor.joinChannel(a.syncChannel,0)},handleFeed:function(b){var a=Videosync;jdata=JSON.parse(b);if(typeof jdata.yt_id!="undefined"){a.updatePlayer(jdata.yt_id,jdata.pos,jdata.started,jdata.tag)}else{a.oldFeedHandler(b)}},removeFeed:function(){var a=Videosync;Meteor.leaveChannel(a.syncChannel);Meteor.callbacks.process=a.oldFeedHandler;a.oldFeedHandler=null},};if(typeof onYouTubeIframeAPIReady!="undefined"){Videosync.oldAPIHandler=onYouTubeIframeAPIReady}onYouTubeIframeAPIReady=function(){Videosync.init();if(Videosync.oldAPIHandler){Videosync.oldAPIHandler()}};